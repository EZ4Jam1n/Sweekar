# Sweekar - AI 陪伴聊天系统

## 系统概述
Sweekar 是一款面向 3-6 岁儿童的 AI 陪伴聊天软件，旨在通过语音互动为孩子提供陪伴，并定期向家长推送孩子的情绪数据。系统通过模拟与特定系统角色的语音互动，提供多种娱乐和教育场景。家长可以选择与不同的系统角色进行语音聊天，且每晚系统会定时推送给家长有关孩子当天的情绪状态。

## 核心功能需求

### 1. 用户管理
- **用户类型：**
  - **家长：** 可以管理孩子的账户、查看孩子的聊天记录和情绪报告。
  - **孩子：** 只能进行与系统角色的语音聊天，不具备管理功能。
  
- **家长管理：**
  - 注册、登录、修改个人信息。
  - 查看孩子的聊天记录、语音互动情况。
  
- **孩子管理：**
  - 创建/管理孩子账户（由家长进行管理）。
  - 语音互动记录保存。

### 2. 语音聊天
- **系统角色：** 系统内有多个固定角色（如：小兔子、小熊等），家长可选择不同的角色来陪伴孩子聊天。
  
- **语音互动：**
  - 孩子通过语音输入与系统角色进行对话。
  - 系统角色通过大模型 API 生成响应并进行语音合成返回。
  - 系统可以识别和处理语音内容（ASR）并通过 TTS 生成语音响应。

### 3. 情绪监测与推送
- **情绪推送：**
  - 系统根据与孩子的互动分析孩子的情绪（如开心、难过等）。
  - 每天晚上 8 点，系统自动推送当天的情绪报告给家长。

### 4. 定时任务
- **定时推送：** 每日晚上 8 点，自动将孩子当天的情绪状态（分析自聊天内容）推送至家长端。

## 系统架构需求

### 1. 后端架构
- **微服务架构：** 后端服务需采用微服务架构进行设计，确保高并发和高可用性。
- **容器化：** 服务容器化，采用 Docker 进行容器化部署，利用 Kubernetes 进行容器编排和自动扩展。
- **API 网关：** 使用 Nginx 作为 API 网关，进行请求路由、负载均衡和安全控制。

### 2. 消息队列
- **RocketMQ：** 用于高并发的消息传递，确保消息的可靠传递和系统的解耦。
  - 消息推送：用于定时推送情绪报告给家长。
  - 语音互动消息：处理孩子与系统角色之间的语音消息交换。

### 3. 数据库设计
- **数据库：** 采用关系型数据库（如 MySQL 或 PostgreSQL）存储用户信息、聊天记录和情绪数据。
  - **用户表：** 存储家长和孩子的信息。
  - **聊天记录表：** 存储与系统角色的每次语音互动。
  - **情绪分析表：** 存储每天的情绪分析结果，以便定期推送给家长。

### 4. 大模型 API
- **第三方大模型 API：** 调用外部提供的大模型 API（如 OpenAI 等）进行语音对话和内容生成。后台不需自行管理模型，只需集成现有 API。

### 5. WebSocket 支持
- **实时通信：** 使用 WebSocket 协议实现客户端与服务器之间的实时双向通信，确保语音聊天和情绪推送的低延迟和高实时性。
  - **语音聊天：** 通过 WebSocket 实时传输语音消息和系统角色的语音回复。
  - **情绪推送：** 通过 WebSocket 实时推送情绪报告给家长。

## API 设计
API 主要分为用户管理、语音聊天、情绪分析与推送等模块。

### 1. 用户管理 API
- **注册/登录 API：** 家长和孩子的注册与认证。
- **用户信息管理 API：** 获取和更新用户信息。

### 2. 语音聊天 API
- **开始聊天 API：** 启动与系统角色的语音聊天。
- **发送语音消息 API：** 孩子发送语音消息，系统返回相应的语音回复。

### 3. 情绪推送 API
- **情绪分析 API：** 对聊天记录进行情绪分析，生成情绪报告。
- **推送 API：** 定时推送情绪报告给家长。

## 技术栈
- **编程语言：** Go 语言，采用高并发、低延迟的性能特点。
- **Web 框架：** Hertz，轻量级、高效的 Go Web 框架，适合构建 RESTful API。
- **消息队列：** RocketMQ，用于高并发的消息传递。
- **数据库：** MySQL/PostgreSQL，关系型数据库用于存储用户信息、聊天记录和情绪数据。
- **容器化与编排：** Docker 进行容器化，Kubernetes 进行容器编排和自动化管理。
- **API 网关：** Nginx 作为 API 网关，提供负载均衡和路由。
- **WebSocket：** 使用 WebSocket 或类似库实现实时通信。

## 关键需求概述

### 1. 并发处理
- 系统需要支持高并发，能够处理大量的用户同时发起语音聊天请求。
- 消息队列需支持高吞吐量，确保系统在高并发情况下仍能稳定运行。

### 2. 定时任务与推送
- 系统需具备定时任务功能，能够准时推送情绪报告给家长，并能根据业务需求扩展定时任务功能。

### 3. 实时互动
- 语音消息需实现低延迟的即时互动，保证孩子和系统角色之间的流畅语音交流。

### 4. 数据一致性与可靠性
- 语音消息和情绪数据必须保持一致性，确保在高并发和故障恢复情况下，数据的完整性和准确性。

## 补充技术建议

### 1. 缓存机制
- **Redis：** 使用 Redis 作为缓存层，存储频繁访问的数据（如用户信息、系统角色配置等），减少数据库压力，提升系统响应速度。

### 2. 安全措施
- **HTTPS：** 使用 HTTPS 加密通信，确保数据传输的安全性。
- **JWT：** 使用 JSON Web Token (JWT) 进行用户身份验证和授权，确保系统的安全性。


## 总结
Sweekar 系统需提供一个高度可扩展、稳定性强且具备高并发处理能力的后端架构，能够处理实时语音聊天、情绪分析与推送等功能。通过合理的数据库设计、微服务架构以及消息队列的使用，确保系统能够处理大规模的用户请求，保证语音聊天的实时性，并能够定时推送孩子的情绪报告给家长。通过引入 WebSocket、Redis、ELK Stack、Prometheus & Grafana 等技术，进一步提升系统的实时性、性能和可维护性。